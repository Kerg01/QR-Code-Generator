<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Generador de Códigos QR Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style id="app-style">
        body { background-color: #f9fafb; font-family: 'Inter', sans-serif; }
        .container { max-width: 800px; }
        .qr-preview { min-height: 250px; min-width: 250px; max-width: 300px; max-height: 300px; margin: 0 auto; position: relative; display: flex; align-items: center; justify-content: center; }
        .color-picker { -webkit-appearance: none; width: 40px; height: 40px; border: none; border-radius: 50%; cursor: pointer; padding: 0; }
        .color-picker::-webkit-color-swatch { border: none; border-radius: 50%; padding: 0; }
        .color-picker::-webkit-color-swatch-wrapper { border: none; border-radius: 50%; padding: 0; }
        .logo-overlay { position: absolute; width: 60px; height: 60px; border-radius: 8px; box-shadow: 0 0 5px rgba(0, 0, 0, 0.3); z-index: 15; pointer-events: none; display: none; background-color: white; padding: 5px; box-sizing: content-box; }
        .logo-overlay img { width: 100%; height: 100%; object-fit: contain; }
        .loading-spinner { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(255, 255, 255, 0.8); display: flex; justify-content: center; align-items: center; z-index: 10; }
        .spinner { width: 40px; height: 40px; border: 4px solid rgba(0, 0, 0, 0.1); border-left-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .btn-download { transition: all 0.2s ease; }
        .btn-download:hover { transform: translateY(-2px); }
    </style>
</head>
<body class="py-8 px-4">
    <div class="container mx-auto bg-white rounded-xl shadow-md p-6 md:p-8">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Generador de Códigos QR</h1>
        
        <div class="md:flex md:space-x-8">
            <div class="md:w-1/2 mb-8 md:mb-0">
                <div class="mb-6">
                    <div class="flex flex-wrap gap-4 mb-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="qr-mode" value="url" class="form-radio" checked>
                            <span class="ml-2">URL</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="qr-mode" value="wifi" class="form-radio">
                            <span class="ml-2">Wi-Fi</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="qr-mode" value="login" class="form-radio">
                            <span class="ml-2">Login</span>
                        </label>
                    </div>
                    
                    <div id="url-section">
                        <label for="url-input" class="block text-sm font-medium text-gray-700 mb-1">Introduce un enlace</label>
                        <input type="url" id="url-input" placeholder="https://www.ejemplo.com" class="w-full px-4 py-2 border border-gray-300 rounded-md mb-2 focus:ring-2 focus:ring-blue-500">
                        <button id="generate-button" class="bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium w-full">Generar QR de Enlace</button>
                    </div>
                    
                    <div id="wifi-section" class="hidden space-y-3">
                        <input type="text" id="wifi-ssid" placeholder="Nombre de red (SSID)" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                        <input type="password" id="wifi-password" placeholder="Contraseña" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                        <select id="wifi-security" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                            <option value="WPA">WPA/WPA2</option>
                            <option value="WEP">WEP</option>
                            <option value="nopass">Sin contraseña</option>
                        </select>
                        <button id="generate-wifi-button" class="bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium w-full">Generar QR Wi-Fi</button>
                    </div>

                    <div id="login-section" class="hidden space-y-3">
                        <p class="text-xs text-gray-500 mb-2 italic">Nota: El formato genera un texto estructurado legible por escáneres.</p>
                        <input type="text" id="login-user" placeholder="Usuario / Correo" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                        <input type="password" id="login-pass" placeholder="Contraseña de la App" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                        <input type="text" id="login-app" placeholder="Nombre de la Aplicación (Opcional)" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                        <button id="generate-login-button" class="bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium w-full">Generar QR de Login</button>
                    </div>
                </div>
                
                <div class="mb-6 grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Color QR</label>
                        <div class="flex items-center">
                            <input type="color" id="foreground-color" value="#000000" class="color-picker" data-color-type="foreground">
                            <span id="foreground-hex" class="ml-2 text-xs text-gray-600">#000000</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Color Fondo</label>
                        <div class="flex items-center">
                            <input type="color" id="background-color" value="#FFFFFF" class="color-picker" data-color-type="background">
                            <span id="background-hex" class="ml-2 text-xs text-gray-600">#FFFFFF</span>
                        </div>
                    </div>
                </div>

                <div class="mb-6 p-4 border border-gray-200 rounded-lg">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-sm font-bold text-gray-700">Logo Central</label>
                        <input type="checkbox" id="logo-toggle" class="form-checkbox h-5 w-5 text-blue-600 rounded">
                    </div>
                    <div id="logo-controls-container" class="hidden">
                        <input type="file" id="logo-file-input" accept="image/*" class="w-full text-xs">
                    </div>
                </div>
            </div>
            
            <div class="md:w-1/2">
                <div class="qr-preview bg-gray-100 rounded-lg p-4 mb-6">
                    <div id="loading-spinner" class="loading-spinner hidden"><div class="spinner"></div></div>
                    <div id="qr-code-container" class="w-full h-full flex items-center justify-center">
                        <div id="qr-placeholder" class="text-center text-gray-400">
                            <i class="fas fa-qrcode text-6xl mb-2"></i>
                            <p class="text-xs">Esperando datos...</p>
                        </div>
                    </div>
                    <img id="logo-overlay" class="logo-overlay" alt="Preview">
                </div>
                
                <div class="mb-4">
                    <select id="qr-resolution" class="w-full px-4 py-2 border border-gray-300 rounded-md text-sm">
                        <option value="500">Media (500x500)</option>
                        <option value="1000" selected>Alta (1000x1000)</option>
                        <option value="2000">HD (2000x2000)</option>
                    </select>
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <button id="download-png" class="btn-download bg-blue-600 text-white py-2 rounded-md text-sm font-medium disabled:opacity-50" data-download-format="png">PNG</button>
                    <button id="download-jpg" class="btn-download bg-purple-600 text-white py-2 rounded-md text-sm font-medium disabled:opacity-50" data-download-format="jpg">JPG</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const DOM = {
                urlInput: document.getElementById('url-input'),
                fgColorInput: document.getElementById('foreground-color'),
                bgColorInput: document.getElementById('background-color'),
                qrCodeContainer: document.getElementById('qr-code-container'),
                qrPlaceholder: document.getElementById('qr-placeholder'),
                loadingSpinner: document.getElementById('loading-spinner'),
                modeRadios: document.querySelectorAll('input[name="qr-mode"]'),
                urlSection: document.getElementById('url-section'),
                wifiSection: document.getElementById('wifi-section'),
                loginSection: document.getElementById('login-section'),
                // WiFi inputs
                wifiSsid: document.getElementById('wifi-ssid'),
                wifiPassword: document.getElementById('wifi-password'),
                wifiSecurity: document.getElementById('wifi-security'),
                // Login inputs
                loginUser: document.getElementById('login-user'),
                loginPass: document.getElementById('login-pass'),
                loginApp: document.getElementById('login-app'),
                // Logo
                logoToggle: document.getElementById('logo-toggle'),
                logoControlsContainer: document.getElementById('logo-controls-container'),
                logoFileInput: document.getElementById('logo-file-input'),
                logoOverlay: document.getElementById('logo-overlay')
            };

            let qr = null;
            let currentMode = 'url';
            let logoDataUrl = null;

            function handleModeChange(mode) {
                currentMode = mode;
                [DOM.urlSection, DOM.wifiSection, DOM.loginSection].forEach(el => el.classList.add('hidden'));
                document.getElementById(`${mode}-section`).classList.remove('hidden');
            }

            DOM.modeRadios.forEach(r => r.addEventListener('change', (e) => handleModeChange(e.target.value)));

            function generateQR() {
                let data = "";
                if (currentMode === 'url') data = DOM.urlInput.value;
                else if (currentMode === 'wifi') {
                    data = `WIFI:S:${DOM.wifiSsid.value};T:${DOM.wifiSecurity.value};P:${DOM.wifiPassword.value};;`;
                } else if (currentMode === 'login') {
                    // Formato estructurado de credenciales
                    data = `LOGIN:APP:${DOM.loginApp.value};U:${DOM.loginUser.value};P:${DOM.loginPass.value};;`;
                }

                if (!data) return alert("Por favor rellena los campos");

                DOM.qrCodeContainer.innerHTML = '';
                qr = new QRCode(DOM.qrCodeContainer, {
                    text: data,
                    width: 250,
                    height: 250,
                    colorDark: DOM.fgColorInput.value,
                    colorLight: DOM.bgColorInput.value,
                    correctLevel: QRCode.CorrectLevel.H
                });
                DOM.qrPlaceholder.classList.add('hidden');
            }

            document.getElementById('generate-button').onclick = generateQR;
            document.getElementById('generate-wifi-button').onclick = generateQR;
            document.getElementById('generate-login-button').onclick = generateQR;

            // Manejo de Logo simple
            DOM.logoToggle.onchange = (e) => DOM.logoControlsContainer.classList.toggle('hidden', !e.target.checked);
            DOM.logoFileInput.onchange = (e) => {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    logoDataUrl = ev.target.result;
                    DOM.logoOverlay.src = logoDataUrl;
                    DOM.logoOverlay.style.display = 'block';
                };
                reader.readAsDataURL(e.target.files[0]);
            };

            // Descarga (Simplicada para el ejemplo)
            document.querySelectorAll('.btn-download').forEach(btn => {
                btn.onclick = () => {
                    const canvas = DOM.qrCodeContainer.querySelector('canvas');
                    if (canvas) {
                        const link = document.createElement('a');
                        link.download = `qr-${currentMode}.png`;
                        link.href = canvas.toDataURL();
                        link.click();
                    }
                };
            });
        });
    </script>
</body>
</html>
